parameters:
- name: testRunType
  type: string
  values:
  - Unit
  - Integration
- name: installationType
  type: string
- name: pythonVersion
  type: number
  default: 3.7
- name: pinRequirements
  type: boolean
  default: False
- name: freezeArtifact
  type: string
- name: freezeFile
  type: string
# Following are used if the installationType is PyPI
- name: pypiUrl
  type: string
- name: versionArtifactName
  type: string
- name: versionArtifactFile
  type: string
# Following used if the installationType is WheelArtifact
- name: wheelArtifactName
  type: string
- name: conda_env
  type: string
  values:
  - interpret_cpu
  default: interpret_cpu
- name: conda_path
  type: string
  default: /usr/share/miniconda/bin

steps:
- task: UsePythonVersion@0
  displayName: 'Use Python ${{parameters.pythonVersion}}'
  inputs:
    versionSpec: '${{parameters.pythonVersion}}' 
    addToPath: true

- bash: |
      echo "##vso[task.prependpath]/data/anaconda/bin"
      conda env list
      ls
      pwd
  displayName: Add Conda to PATH

- bash: |
      python tools/generate_conda_files.py
      conda env create -n ${{parameters.conda_env}} --file=interpret_cpu.yaml
  displayName: 'Creating Conda Environment with dependencies'

- bash: |
      cd ${{parameters.conda_path}}
      source activate ${{parameters.conda_env}}
      cd $(Agent.BuildDirectory)
      python -m pip install flake8
      flake8 --ignore=E501,E266,W503,F403,F405,E731,F821,E203 ./python/
  displayName: 'Run flake8'