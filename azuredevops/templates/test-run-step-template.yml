parameters:
- name: testRunType
  type: string
  values:
  - Unit
  - Integration
- name: installationType
  type: string
- name: pythonVersion
  type: number
  default: 3.7
- name: pinRequirements
  type: boolean
  default: False
- name: freezeArtifact
  type: string
- name: freezeFile
  type: string
# Following are used if the installationType is PyPI
- name: pypiUrl
  type: string
- name: versionArtifactName
  type: string
- name: versionArtifactFile
  type: string
# Following used if the installationType is WheelArtifact
- name: wheelArtifactName
  type: string
- name: conda_env
  type: string
  default: interpret_conda_env
- name: conda_path
  type: string
  default: /usr/share/miniconda/bin

steps:
- template: conda-path-step-template.yml

- bash: |
      python tools/generate_conda_files.py --name ${{parameters.conda_env}} --python-version ${{parameters.pythonVersion}}
      conda env create -n ${{parameters.conda_env}} --file=${{parameters.conda_env}}.yaml
  displayName: 'Creating Conda Environment with dependencies'

- bash: |
      source activate ${{parameters.conda_env}}
      python --version
  displayName: 'Verify Python version'

- bash: |
      source activate ${{parameters.conda_env}}
      python -m pip install flake8
      flake8 --ignore=E501,E266,W503,F403,F405,E731,F821,E203 ./python/
  displayName: 'Run flake8'